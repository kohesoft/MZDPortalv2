@using MZDNETWORK.Models
@model IEnumerable<DilekOneri>



<head>
    <link rel="stylesheet" href="~/Content/all.min.css" />
    <link rel="stylesheet" href="~/Content/DilekIstek.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8" />

</head>

<div class="container" style="max-width:100%; max-height:100%;">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Dilek ve Öneri Kutusu</h3>
            <div class="card-toolbar">
                <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Arama kutusu" class="form-control" style="width: 300px;">
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive" style="max-height: 550px; overflow-y: auto;">
                <table class="table table-striped table-bordered table-hover" id="userTable">
                    <thead>
                        <tr>
                            <th>Kullanıcı adı</th>
                            <th style="width:35%">Mesaj</th>
                            <th style="width:35%">Bildirim</th>
                            <th>Tarih</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@item.Username</td>
                                <td style="width:35%">@item.Mesaj</td>
                                <td style="width:35%">@item.Bilidirim</td>
                                <td>@item.GonderimTarihi</td>
                                <td><button class="btn btn-primary" onclick="replyToUser('@item.Username', @item.Id)">Yanıtla</button></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Reply Modal -->
<div class="modal fade" id="replyModal" tabindex="-1" role="dialog" aria-labelledby="replyModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="replyModalLabel">Yanıtla</h5>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="replyMessage">Mesaj</label>
                    <textarea class="form-control" id="replyMessage" rows="5" placeholder="Yanıtınızı buraya yazın..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="$('#replyModal').modal('hide');">Kapat</button>
                <button type="button" class="btn btn-primary" id="sendReplyButton">Gönder</button>
            </div>
        </div>
    </div>
</div>



<script>
    function searchTable() {
        var input = document.getElementById("searchInput");
        var filter = input.value.toUpperCase();
        var table = document.getElementById("userTable");
        var tbody = table.getElementsByTagName("tbody")[0];
        var rows = tbody.getElementsByTagName("tr");

        for (var i = 0; i < rows.length; i++) {
            var cells = rows[i].getElementsByTagName("td");
            rows[i].style.display = "none";
            for (var j = 0; j < cells.length; j++) {
                if (cells[j]) {
                    var cellText = cells[j].textContent || cells[j].innerText;
                    if (cellText.toUpperCase().indexOf(filter) > -1) {
                        rows[i].style.display = "";
                        break;
                    }
                }
            }
        }
    }

function replyToUser(username, messageId) {
    $('#replyModal').modal('show');
    $('#sendReplyButton').off('click').on('click', function () {
        var message = $('#replyMessage').val();
        if (message) {
            $.ajax({
                url: '@Url.Action("UpdateMessage", "DilekOneri")',
                type: 'POST',
                data: {
                    id: messageId,
                    message: message
                },
                success: function (response) {
                    if (response.success) {
                        alert('Mesaj başarıyla güncellendi.');
                        $('#replyModal').modal('hide');
                    } else {
                        alert('Mesaj güncellenirken bir hata oluştu: ' + response.error);
                    }
                },
                error: function () {
                    alert('Mesaj güncellenirken bir hata oluştu.');
                }
            });
        } else {
            alert('Mesaj alanı boş olamaz.');
        }
    });
}
</script>

<style>
    .card-toolbar {
        display: flex;
        justify-content: flex-end;
    }

    .homev2 {
        position: absolute;
        top: 100px;
        left: 300px;
        height: 85vh;
        width: calc(94% - 250px);
        transition: var(--tran-05);
    }

    .modal-header {
        background-color: #007bff;
        color: white;
    }

    .modal-footer {
        display: flex;
        justify-content: space-between;
    }

        .modal-footer .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }

        .modal-footer .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
        }
</style>

