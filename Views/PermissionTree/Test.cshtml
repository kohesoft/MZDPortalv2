@{
    ViewBag.Title = "PermissionTree Test";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid p-6">
    <div class="bg-white rounded-lg shadow p-6">
        <h1 class="text-2xl font-bold mb-4">üß™ PermissionTree Controller Test</h1>
        
        <div class="space-y-4">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <h3 class="font-semibold text-blue-800 mb-2">üì° API Test Endpoints</h3>
                <div class="space-y-2">
                    <button onclick="testGetPermissionTree()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        Test GetPermissionTree API
                    </button>
                    <button onclick="testGetStatistics()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        Test GetPermissionStatistics API
                    </button>
                    <button onclick="goToMainPage()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                        Go to Main PermissionTree Page
                    </button>
                </div>
            </div>
            
            <div class="bg-gray-50 border rounded-lg p-4">
                <h3 class="font-semibold mb-2">üìä Test Results</h3>
                <div id="testResults" class="bg-white border rounded p-3 min-h-48 font-mono text-sm overflow-auto">
                    Click test buttons to see results...
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function logResult(test, data, success = true) {
    const timestamp = new Date().toLocaleTimeString();
    const icon = success ? '‚úÖ' : '‚ùå';
    const color = success ? 'green' : 'red';
    
    const resultDiv = document.getElementById('testResults');
    resultDiv.innerHTML += `
        <div style="color: ${color}; margin-bottom: 10px;">
            ${icon} [${timestamp}] ${test}:<br>
            <div style="margin-left: 20px; color: #333;">
                ${typeof data === 'object' ? JSON.stringify(data, null, 2) : data}
            </div>
        </div>
    `;
    resultDiv.scrollTop = resultDiv.scrollHeight;
}

function testGetPermissionTree() {
    logResult('Testing GetPermissionTree API...', 'Starting test...', true);
    
    $.get('@Url.Action("GetPermissionTree", "PermissionTree")')
        .done(function(data) {
            if (data.error) {
                logResult('GetPermissionTree API', `Error: ${data.error}`, false);
            } else {
                logResult('GetPermissionTree API', `Success! Found ${data.length} permission nodes`, true);
                console.log('Full data:', data);
            }
        })
        .fail(function(xhr, status, error) {
            logResult('GetPermissionTree API', `AJAX Error: ${status} - ${error}`, false);
        });
}

function testGetStatistics() {
    logResult('Testing GetPermissionStatistics API...', 'Starting test...', true);
    
    $.get('@Url.Action("GetPermissionStatistics", "PermissionTree")')
        .done(function(data) {
            if (data.error) {
                logResult('GetPermissionStatistics API', `Error: ${data.error}`, false);
            } else {
                logResult('GetPermissionStatistics API', `Success! Stats: ${JSON.stringify(data)}`, true);
            }
        })
        .fail(function(xhr, status, error) {
            logResult('GetPermissionStatistics API', `AJAX Error: ${status} - ${error}`, false);
        });
}

function goToMainPage() {
    window.location.href = '@Url.Action("Index", "PermissionTree")';
}

// Test controller accessibility on page load
$(document).ready(function() {
    logResult('Page Load Test', 'PermissionTree/Test page loaded successfully! Controller is accessible.', true);
    
    // Test basic controller ping
    $.get('@Url.Action("Index", "PermissionTree")')
        .done(function() {
            logResult('Controller Ping', 'PermissionTree controller responds successfully!', true);
        })
        .fail(function(xhr, status, error) {
            logResult('Controller Ping', `Controller not accessible: ${status} - ${error}`, false);
        });
});
</script> 