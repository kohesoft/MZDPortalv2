@model IEnumerable<MZDNETWORK.Models.User>


<head>
    <link rel="stylesheet" href="~/Content/all.min.css" />
    <link rel="stylesheet" href="~/Content/DilekIstek.css" />
    <meta charset="utf-8" />
</head>

<div class="container" style="max-width:100%; max-height:100%;">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Kullanıcı Listesi</h3>
            <div class="card-toolbar">
                <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Arama kutusu" class="form-control" style="width: 300px; margin-right: 10px;">
                @Html.ActionLink("Kullanıcı Oluştur", "Create", null, new { @class = "btn btn-primary" })
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive" style="max-height: 550px; overflow-y: auto;">
                <table class="table table-striped table-bordered table-hover" id="userTable">
                    <thead>
                        <tr>
                            <th>Kullanıcı adı</th>
                            <th>Şifre</th>
                            <th>Yetki</th>
                            <th>İsim</th>
                            <th>Soyisim</th>
                            <th>Departman ve Pozisyon</th>
                            <th>Dahili</th>
                            <th>Cep tel</th>
                            <th>İç mail</th>
                            <th>Dış mail</th>
                            <th>Sicil</th>
                            <th>İşlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            var userInfo = item.UserInfo.FirstOrDefault();
                            <tr class="user-row" data-user-id="@item.Id">
                                <td>@Html.DisplayFor(modelItem => item.Username)</td>
                                <td>@Html.DisplayFor(modelItem => item.Password)</td>
                                <td>@Html.DisplayFor(modelItem => item.Role)</td>
                                <td>@Html.DisplayFor(modelItem => item.Name)</td>
                                <td>@Html.DisplayFor(modelItem => item.Surname)</td>
                                <td>
                                    <div>@Html.DisplayFor(modelItem => item.Department)</div>
                                    <div>@Html.DisplayFor(modelItem => item.Position)</div>
                                </td>
                                <td>@Html.DisplayFor(modelItem => item.Intercom)</td>
                                <td>@Html.DisplayFor(modelItem => item.PhoneNumber)</td>
                                <td>@Html.DisplayFor(modelItem => item.InternalEmail)</td>
                                <td>@Html.DisplayFor(modelItem => item.ExternalEmail)</td>
                                <td>@Html.DisplayFor(modelItem => item.Sicil)</td>
                                <td>
                                    @Html.ActionLink("Düzenle", "Edit", new { id = item.Id }, new { @class = "btn btn-sm btn-warning" })
                                    @Html.ActionLink("Sil", "Delete", new { id = item.Id }, new { @class = "btn btn-sm btn-danger" })
                                </td>
                            </tr>
                            <tr class="user-info-row" id="user-info-@item.Id" style="display: none;">
                                <td colspan="12">
                                    <div class="user-info">
                                        <p><strong>E-posta:</strong> @Html.DisplayFor(modelItem => userInfo.Email)</p>
                                        <p><strong>Telefon Numarası:</strong> @Html.DisplayFor(modelItem => userInfo.RealPhoneNumber)</p>
                                        <p><strong>Adres:</strong> @Html.DisplayFor(modelItem => userInfo.Adres)</p>
                                        <p><strong>Adres 2:</strong> @Html.DisplayFor(modelItem => userInfo.Adres2)</p>
                                        <p><strong>Şehir:</strong> @Html.DisplayFor(modelItem => userInfo.Sehir)</p>
                                        <p><strong>Ülke:</strong> @Html.DisplayFor(modelItem => userInfo.Ulke)</p>
                                        <p><strong>Posta Kodu:</strong> @Html.DisplayFor(modelItem => userInfo.Postakodu)</p>
                                        <p><strong>Kan Grubu:</strong> @Html.DisplayFor(modelItem => userInfo.KanGrubu)</p>
                                        <p><strong>Doğum Tarihi:</strong> @Html.DisplayFor(modelItem => userInfo.DogumTarihi)</p>
                                        <p><strong>Cinsiyet:</strong> @Html.DisplayFor(modelItem => userInfo.Cinsiyet)</p>
                                        <p><strong>Medeni Durum:</strong> @Html.DisplayFor(modelItem => userInfo.MedeniDurum)</p>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    function searchTable() {
        var input = document.getElementById("searchInput");
        var filter = input.value.toUpperCase();
        var table = document.getElementById("userTable");
        var tbody = table.getElementsByTagName("tbody")[0];
        var rows = tbody.getElementsByTagName("tr");

        for (var i = 0; i < rows.length; i++) {
            if (rows[i].classList.contains("user-info-row")) {
                continue; // user-info-row sınıfına sahip satırları atla
            }
            var cells = rows[i].getElementsByTagName("td");
            rows[i].style.display = "none";
            for (var j = 0; j < cells.length; j++) {
                if (cells[j] && j !== 1) { // 1. sütun (Şifre) hariç
                    var cellText = cells[j].textContent || cells[j].innerText;
                    if (cellText.toUpperCase().indexOf(filter) > -1) {
                        rows[i].style.display = "";
                        break;
                    }
                }
            }
        }
    }


    document.addEventListener("DOMContentLoaded", function () {
        var userRows = document.querySelectorAll(".user-row");
        userRows.forEach(function (row) {
            row.addEventListener("click", function () {
                var userId = this.getAttribute("data-user-id");
                var userInfoRow = document.getElementById("user-info-" + userId);
                if (userInfoRow.style.display === "none") {
                    userInfoRow.style.display = "table-row";
                } else {
                    userInfoRow.style.display = "none";
                }
            });
        });
    });
</script>

<style>
    .card-toolbar {
        display: flex;
        justify-content: flex-end;
    }

    .card-toolbar {
        display: flex;
        justify-content: flex-end;
        margin-bottom: 10px; /* Aralık ayarı */
    }

    .homev2 {
        position: absolute;
        top: 100px;
        left: 300px;
        height: 85vh;
        width: calc(94% - 250px);
        transition: var(--tran-05);
        padding: 15px; /* İçerik aralığı */
    }

    table {
        width: 100%; /* Tablo genişliğini ayarla */
        margin-bottom: 20px; /* Tablo altındaki aralık */
    }

    th, td {
        padding: 10px; /* Hücre içi aralık */
        text-align: left; /* Metin hizalaması */
    }

    .user-info {
        background-color: #f9f9f9;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }
</style>