@model IEnumerable<MZDNETWORK.Models.LeaveRequest>

@{
    ViewBag.Title = "İzin Taleplerim";
}

<div class="min-h-screen bg-gray-50 py-12">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center mb-8">
            <div>
                <h2 class="text-3xl font-bold text-gray-900">İzin Taleplerim</h2>
                <p class="mt-2 text-sm text-gray-600">Tüm izin taleplerinizi buradan görüntüleyebilirsiniz</p>
            </div>
            <a href="@Url.Action("Create")" class="inline-flex items-center px-6 py-3 border-2 border-transparent text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200">
                <svg class="h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                </svg>
                Yeni İzin Talebi
            </a>
        </div>

        <!-- Arama ve Filtreleme Bölümü -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <form method="get" action="@Url.Action("Index")" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Arama Kutusu -->
                    <div>
                        <label for="searchTerm" class="block text-sm font-medium text-gray-700 mb-2">Arama</label>
                        <input type="text" 
                               id="searchTerm" 
                               name="searchTerm" 
                               value="@Request.QueryString["searchTerm"]"
                               placeholder="İzin türü, departman veya vekil ara..."
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>

                    <!-- İzin Türü Filtresi -->
                    <div>
                        <label for="leaveType" class="block text-sm font-medium text-gray-700 mb-2">İzin Türü</label>
                        <select id="leaveType" 
                                name="leaveType" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Tümü</option>
                            <option value="Annual" @(Request.QueryString["leaveType"] == "Annual" ? "selected" : "")>Yıllık İzin</option>
                            <option value="Sick" @(Request.QueryString["leaveType"] == "Sick" ? "selected" : "")>Hastalık İzni</option>
                            <option value="Excuse" @(Request.QueryString["leaveType"] == "Excuse" ? "selected" : "")>Mazeret İzni</option>
                            <option value="Unpaid" @(Request.QueryString["leaveType"] == "Unpaid" ? "selected" : "")>Ücretsiz İzin</option>
                            <option value="Other" @(Request.QueryString["leaveType"] == "Other" ? "selected" : "")>Diğer</option>
                        </select>
                    </div>

                    <!-- Durum Filtresi -->
                    <div>
                        <label for="status" class="block text-sm font-medium text-gray-700 mb-2">Durum</label>
                        <select id="status" 
                                name="status" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Tümü</option>
                            <option value="Pending" @(Request.QueryString["status"] == "Pending" ? "selected" : "")>Beklemede</option>
                            <option value="Approved" @(Request.QueryString["status"] == "Approved" ? "selected" : "")>Onaylandı</option>
                            <option value="Rejected" @(Request.QueryString["status"] == "Rejected" ? "selected" : "")>Reddedildi</option>
                        </select>
                    </div>

                    <!-- Tarih Aralığı -->
                    <div>
                        <label for="dateRange" class="block text-sm font-medium text-gray-700 mb-2">Tarih Aralığı</label>
                        <select id="dateRange" 
                                name="dateRange" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Tümü</option>
                            <option value="thisMonth" @(Request.QueryString["dateRange"] == "thisMonth" ? "selected" : "")>Bu Ay</option>
                            <option value="lastMonth" @(Request.QueryString["dateRange"] == "lastMonth" ? "selected" : "")>Geçen Ay</option>
                            <option value="thisYear" @(Request.QueryString["dateRange"] == "thisYear" ? "selected" : "")>Bu Yıl</option>
                            <option value="lastYear" @(Request.QueryString["dateRange"] == "lastYear" ? "selected" : "")>Geçen Yıl</option>
                        </select>
                    </div>
                </div>

                <!-- Butonlar -->
                <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                    <div class="flex space-x-3">
                        <button type="submit" 
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200">
                            <svg class="h-4 w-4 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                            </svg>
                            Ara
                        </button>
                        <a href="@Url.Action("Index")" 
                           class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200">
                            <svg class="h-4 w-4 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            Temizle
                        </a>
                    </div>
                    
                    <!-- Sonuç Sayısı -->
                    <div class="text-sm text-gray-600">
                        @Model.Count() sonuç bulundu
                    </div>
                </div>
            </form>
        </div>

        <div class="bg-white rounded-xl shadow-xl overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">İzin Türü</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Başlangıç</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Bitiş</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Süre</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Departman</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Vekil</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Durum</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Talep Tarihi</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">İşlemler</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        @if (Model.Any())
                        {
                            foreach (var item in Model)
                            {
                                <tr class="hover:bg-gray-50 transition-colors duration-200">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                        @MZDNETWORK.Helpers.EnumDisplayHelper.ToDisplayName(item.LeaveType)
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                        @item.StartDate.ToString("dd.MM.yyyy HH:mm")
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                        @item.EndDate.ToString("dd.MM.yyyy HH:mm")
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                        @item.DurationDisplay
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">@item.Department</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">@item.SubstituteName</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="@GetStatusClasses(item.Status)">
                                            @GetSimplifiedStatusDisplay(item.Status)
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                        @item.CreatedAt.ToString("dd.MM.yyyy HH:mm")
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <a href="@Url.Action("Details", new { id = item.Id })" class="inline-flex items-center text-blue-600 hover:text-blue-900 transition-colors duration-200">
                                            <svg class="h-4 w-4 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                            </svg>
                                            Detaylar
                                        </a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="9" class="px-6 py-12 text-center">
                                    <div class="flex flex-col items-center">
                                        <svg class="h-12 w-12 text-gray-400 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                        <h3 class="text-lg font-medium text-gray-900 mb-2">Sonuç Bulunamadı</h3>
                                        <p class="text-gray-600">Arama kriterlerinize uygun izin talebi bulunamadı.</p>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@functions {
    string GetStatusClasses(MZDNETWORK.Models.LeaveStatus status)
    {
        var baseClasses = "inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ";
        
        switch (status)
        {
            case MZDNETWORK.Models.LeaveStatus.Approved:
            case MZDNETWORK.Models.LeaveStatus.ConditionallyApproved:
                return baseClasses + "bg-green-100 text-green-800";
            case MZDNETWORK.Models.LeaveStatus.Rejected:
                return baseClasses + "bg-red-100 text-red-800";
            default: // PendingSupervisor ve PendingManager
                return baseClasses + "bg-blue-100 text-blue-800";
        }
    }

    string GetSimplifiedStatusDisplay(MZDNETWORK.Models.LeaveStatus status)
    {
        switch (status)
        {
            case MZDNETWORK.Models.LeaveStatus.Approved:
            case MZDNETWORK.Models.LeaveStatus.ConditionallyApproved:
                return "Onaylandı";
            case MZDNETWORK.Models.LeaveStatus.Rejected:
                return "Reddedildi";
            case MZDNETWORK.Models.LeaveStatus.PendingSupervisor:
            case MZDNETWORK.Models.LeaveStatus.PendingManager:
                return "Beklemede";
            default:
                return "Beklemede";
        }
    }
} 