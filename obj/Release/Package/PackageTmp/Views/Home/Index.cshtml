@model List<Gonderi>
@using System.Linq

@{
    ViewBag.Title = "Ana Sayfa";
    Model.Reverse();
    var imageFiles = ViewBag.ImageFiles as List<string>;
}
<head>
    <link rel="stylesheet" href="~/Content/coursel.css" />
</head>

<body style="overflow-y: auto;">
    <div class="container" style="max-width:100%; max-height:100%;">


<!--
            <div class="image-thumbnail-carousel">
                <section class="image-display">
                    <div class="screen">
                        -- Büyük resim burada gösterilecek --
        @if (imageFiles != null && imageFiles.Any())
        {
            <img id="mainImage" src="~/anaimgs/@imageFiles.First()" alt="Main Image" style="width: 100%; height: auto;" />
        }
    </div>
    </section>
    <p style="text-align:center; font-size:small;"> Tam halini görüntülemek için resmin üzerinde sağ tık > Resmi yeni sekmede aç</p>
    <section class="thumbnail-carousel">
        <button type="button" class="carousel__btn prev" aria-label="Previous slide">
            <svg width="16" height="16" fill="currentColor" class="arrow-icon arrow-left-circle" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8m15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5z" />
            </svg>
        </button>
        <ul class="carousel__slider">
            @foreach (var imageFile in imageFiles)
            {
                <li class="carousel__slide">
                    <div class="thumbnail">
                        <img loading="lazy" src="~/anaimgs/@imageFile" alt="" onclick="updateMainImage('@imageFile')">
                    </div>
                </li>
            }
        </ul>
        <button type="button" class="carousel__btn next" aria-label="Next slide">
            <svg width="16" height="16" fill="currentColor" class="arrow-icon arrow-right-circle" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8m15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0M4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5z" />
            </svg>
        </button>
    </section>
    </div>
-->
    <h2 style="text-align:center;">DUYURULAR</h2>

    <div class="timeline" id="timeline">
        @foreach (var post in Model)
        {
            <div class="timeline-item">
                <div class="timeline-content">
                    <h3>@post.Title</h3>
                    <p>@Html.Raw(post.Content)</p>
                    <small>@post.CreatedAt.ToString("g")</small>
                </div>
            </div>
        }
    </div>

    <p id="loading" style="text-align:center; display:none;">Yükleniyor...</p>
    </div>

    <div class="modal fade" id="feedbackModal" tabindex="-1" role="dialog" aria-labelledby="feedbackModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="feedbackModalLabel">Geri Bildirim</h5>
                </div>
                <div class="modal-body">
                    <p>Portalı beğendiniz mi?</p>
                    <button type="button" class="btn btn-success" id="likeButton">Evet</button>
                    <button type="button" class="btn btn-danger" id="dislikeButton">Hayır</button>
                    <div id="suggestionDiv" style="display:none; margin-top: 10px;">
                        <label for="suggestionInput">Ne önerirsiniz?</label>
                        <input type="text" class="form-control" id="suggestionInput">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="submitFeedbackButton" style="display:none;">Gönder</button>
                </div>
            </div>
        </div>
    </div>

</body>


<style>

    .timeline {
        position: relative;
        width: 100%;
        margin: auto;
        padding: 20px 0;
        list-style: none;
    }

        .timeline:before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #ddd;
            left: 50%;
            margin-left: -1px;
        }

    .timeline-item {
        position: relative;
        margin: 20px 0;
    }

        .timeline-item:before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007bff;
            top: 0;
            left: 50%;
            margin-left: -10px;
        }

    .timeline-content {
        padding: 50px;
        background: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 5px;
        position: relative;
        width: 45%;
        overflow: hidden; /* Taşan içeriği gizlemek için */
        word-wrap: break-word; /* Uzun kelimeleri bölmek için */
    }

    .timeline-item:nth-child(odd) .timeline-content {
        left: 0;
    }

    .timeline-item:nth-child(even) .timeline-content {
        left: 55%;
    }

    .timeline-content h3 {
        margin-top: 0;
        color: #007bff;
    }

    .timeline-content small {
        color: #888;
    }

    .homev2 {
        position: relative; /* absolute yerine relative kullanıldı */
        top: 100px;
        left: 50px;
        min-height: 85vh; /* height yerine min-height kullanıldı */
        width: calc(94% - 250px);
        transition: var(--tran-05);
    }

    h2 {
        margin-top: 0;
        color: #007bff;
        text-shadow: 0 0 5px rgba(0, 123, 255, 0.5); /* Mavi glow efekti */
    }

    .modal-header {
        background-color: #007bff;
        color: white;
    }

    .modal-footer {
        justify-content: center;
    }
</style>

<script src="~/Scripts/jquery.signalR-2.4.3.min.js"></script>
<script src="~/signalr/hubs"></script>
<script src="~/Scripts/coursel.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch('@Url.Action("HasFeedback", "Feedback")', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (!data.hasFeedback) {
                $('#feedbackModal').modal('show');
            }
        });

        document.getElementById('likeButton').addEventListener('click', function() {
            submitFeedback(true, "");
            $('#feedbackModal').modal('hide');
        });

        document.getElementById('dislikeButton').addEventListener('click', function() {
            document.getElementById('suggestionDiv').style.display = 'block';
            document.getElementById('submitFeedbackButton').style.display = 'block';
        });

        document.getElementById('submitFeedbackButton').addEventListener('click', function() {
            var suggestion = document.getElementById('suggestionInput').value;
            submitFeedback(false, suggestion);
            $('#feedbackModal').modal('hide');
        });
    });

    function submitFeedback(liked, suggestion) {
        fetch('@Url.Action("SubmitFeedback", "Feedback")', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest',
                'RequestVerificationToken': '@Html.AntiForgeryToken()'
            },
            body: JSON.stringify({ liked: liked, suggestion: suggestion })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                localStorage.setItem("feedbackGiven", "true");
            } else {
                alert(data.message);
            }
        });
    }
</script>
