@{
    // Fotoğrafları sunucu tarafında alıyoruz
    var photos = Directory.GetFiles(Server.MapPath("~/UploadPhotosMerkez"))
        .Select(path => new
        {
            FileName = Path.GetFileName(path),
            // Dosya adından tarihi çıkarmak için örnek: menu_20230501.jpg
            Date = System.Text.RegularExpressions.Regex.Match(Path.GetFileName(path), @"(\d{8})").Success
                ? DateTime.ParseExact(System.Text.RegularExpressions.Regex.Match(Path.GetFileName(path), @"(\d{8})").Groups[1].Value, "yyyyMMdd", null)
                : (DateTime?)null
        })
        .Where(x => x.Date != null)
        .OrderByDescending(x => x.Date)
        .ToList();
    var photoJson = Newtonsoft.Json.JsonConvert.SerializeObject(
        photos.Select(x => new
        {
            filename = x.FileName,
            date = x.Date?.ToString("yyyy-MM-dd"),
            displayDate = x.Date?.ToString("d MMMM yyyy", new System.Globalization.CultureInfo("tr-TR"))
        })
    );
}

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merkez Yemek Listesi</title>
    <link href="~/Content/tailwind.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/Content/all.min.css" />
    <link rel="stylesheet" href="~/Content/merkezyemeklistesi.css" />
    <link rel="stylesheet" href="~/Content/boxicons.min.css" />
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-6">
    <div class="max-w-6xl mx-auto">
        <div class="menu-container">
            <div class="menu-header">
                <h1 class="menu-title text-2xl md:text-3xl">
                    <i class='bx bx-restaurant'></i>
                    Merkez Yemek Listesi
                </h1>
                <p class="text-sm md:text-base mt-2 opacity-90">Günlük menülerimizi inceleyebilirsiniz</p>
            </div>
            <div class="menu-body">
                <div class="date-filter" id="dateFilter"></div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="menuGrid">
                    <div class="empty-state">
                        <i class='bx bx-loader-alt bx-spin'></i>
                        <p>Menüler yükleniyor...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Lightbox for image preview -->
    <div class="lightbox" id="lightbox">
        <div class="lightbox-content">
            <button class="lightbox-close" id="lightboxClose">
                <i class='bx bx-x'></i>
            </button>
            <img src="" alt="Yemek Menüsü" class="lightbox-image" id="lightboxImage">
            <div class="lightbox-nav">
                <button id="prevImage"><i class='bx bx-chevron-left'></i></button>
                <button id="nextImage"><i class='bx bx-chevron-right'></i></button>
            </div>
        </div>
    </div>
    <script>
        // Sunucu tarafı fotoğraf verisi
        const menus = @Html.Raw(photoJson);

        // Ay isimleri
        const monthNames = ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'];

        // Benzersiz aylar
        const months = [...new Set(menus.map(menu => {
            const date = new Date(menu.date);
            return `${date.getFullYear()}-${date.getMonth() + 1}`;
        }))];

        // Ay filtre butonları
        const dateFilter = document.getElementById('dateFilter');
        const allButton = document.createElement('button');
        allButton.textContent = 'Tümü';
        allButton.classList.add('active');
        allButton.dataset.filter = 'all';
        dateFilter.appendChild(allButton);

        months.forEach(month => {
            const [year, monthNum] = month.split('-');
            const button = document.createElement('button');
            button.textContent = `${monthNames[parseInt(monthNum) - 1]} ${year}`;
            button.dataset.filter = month;
            dateFilter.appendChild(button);
        });

        // Menüleri göster
        const menuGrid = document.getElementById('menuGrid');
        function displayMenus(filter = 'all') {
            menuGrid.innerHTML = '';
            let filteredMenus = menus;
            if (filter !== 'all') {
                filteredMenus = menus.filter(menu => {
                    const date = new Date(menu.date);
                    const menuMonth = `${date.getFullYear()}-${date.getMonth() + 1}`;
                    return menuMonth === filter;
                });
            }
            if (filteredMenus.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state col-span-full';
                emptyState.innerHTML = `
                    <i class='bx bx-calendar-x'></i>
                    <p>Bu ay için yemek menüsü bulunamadı.</p>
                `;
                menuGrid.appendChild(emptyState);
                return;
            }
            filteredMenus.forEach((menu, index) => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';
                menuItem.style.animationDelay = `${index * 0.1}s`;
                menuItem.innerHTML = `
                    <div class="bg-white rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow">
                        <div class="relative pb-[75%]">
                            <img src="/UploadPhotosMerkez/${menu.filename}" alt="${menu.displayDate} Menüsü" class="absolute inset-0 w-full h-full object-cover menu-image" data-index="${menus.indexOf(menu)}" />
                        </div>
                        <div class="p-4">
                            <h3 class="font-medium">${menu.displayDate} Menüsü</h3>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-sm text-gray-500">
                                    <i class="bx bx-restaurant"></i> Haftalık Menü
                                </span>
                                <button class="view-menu-btn text-sm px-3 py-1 bg-orange-100 text-orange-600 rounded-full hover:bg-orange-200 transition-colors"
                                        data-index="${menus.indexOf(menu)}">
                                    Görüntüle
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                menuGrid.appendChild(menuItem);
            });
            // Görüntüle butonları ve resimlere tıklama
            document.querySelectorAll('.view-menu-btn, .menu-image').forEach(el => {
                el.addEventListener('click', function() {
                    const idx = parseInt(this.dataset.index);
                    openLightbox(idx);
                });
            });
        }
        displayMenus();

        // Filtreleme
        dateFilter.addEventListener('click', function(e) {
            if (e.target.tagName === 'BUTTON') {
                document.querySelectorAll('#dateFilter button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                displayMenus(e.target.dataset.filter);
            }
        });

        // Lightbox
        const lightbox = document.getElementById('lightbox');
        const lightboxImage = document.getElementById('lightboxImage');
        const lightboxClose = document.getElementById('lightboxClose');
        const prevButton = document.getElementById('prevImage');
        const nextButton = document.getElementById('nextImage');
        let currentIndex = null;

        function openLightbox(idx) {
            currentIndex = idx;
            const menu = menus[idx];
            lightboxImage.src = `/UploadPhotosMerkez/${menu.filename}`;
            lightboxImage.alt = `${menu.displayDate} Menüsü`;
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        function closeLightbox() {
            lightbox.classList.remove('active');
            document.body.style.overflow = '';
            currentIndex = null;
        }
        function showPrevImage() {
            if (currentIndex === null) return;
            currentIndex = (currentIndex - 1 + menus.length) % menus.length;
            openLightbox(currentIndex);
        }
        function showNextImage() {
            if (currentIndex === null) return;
            currentIndex = (currentIndex + 1) % menus.length;
            openLightbox(currentIndex);
        }
        lightboxClose.addEventListener('click', closeLightbox);
        prevButton.addEventListener('click', showPrevImage);
        nextButton.addEventListener('click', showNextImage);
        lightbox.addEventListener('click', function(e) {
            if (e.target === lightbox) closeLightbox();
        });
        document.addEventListener('keydown', function(e) {
            if (!lightbox.classList.contains('active')) return;
            if (e.key === 'Escape') closeLightbox();
            else if (e.key === 'ArrowLeft') showPrevImage();
            else if (e.key === 'ArrowRight') showNextImage();
        });
    </script>
</body>
</html>
