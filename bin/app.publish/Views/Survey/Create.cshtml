@model MZDNETWORK.Models.Survey

<h2>Yeni Anket Oluştur</h2>
<form method="post">
    <div class="form-group">
        <label>Anket Başlığı</label>
        <input type="text" class="form-control" name="Title" required />
    </div>

    <div class="form-group">
        <label>Açıklama</label>
        <textarea class="form-control" name="Description"></textarea>
    </div>

    <div class="form-group">
        <label>Süre (dakika)</label>
        <div>
            <button type="button" class="btn btn-sm btn-outline-danger duration-button" data-minutes="30">30 Dakika</button>
            <button type="button" class="btn btn-sm btn-outline-danger duration-button" data-minutes="60">1 Saat</button>
            <button type="button" class="btn btn-sm btn-outline-danger duration-button" data-minutes="600">10 Saat</button>
            <button type="button" class="btn btn-sm btn-outline-danger duration-button" data-minutes="1440">1 Gün</button>
        </div>
        <input type="number" class="form-control" id="duration-input" name="Duration" required placeholder="Butonlardan süre ekleyebilir yada düzenleme yapabilisiniz" />
    </div>

    <h3>Sorular</h3>
    <div id="questions-container">
        <!-- Sorular buraya eklenecek -->
    </div>

    <br><br>
    <button type="button" id="add-question" class="btn btn-warning">Soru Ekle</button>
    <button type="submit" class="btn btn-success">Kaydet</button>
</form>

@section scripts {
    <script src="~/Scripts/jquery-3.7.1.js"></script>
    <script>
        var questionIndex = 0;

        $("#add-question").click(function () {
            var html = `
                <div class="question-item">
                    <hr>
                    <label>Soru Metni</label>
                    <input type="text" class="form-control" name="Questions[${questionIndex}].QuestionText" required />

                    <label>Soru Tipi</label>
                    <select class="form-control question-type" name="Questions[${questionIndex}].Type">
                        <option value="Text">Serbest Metin</option>
                        <option value="Radio">Tek Seçenek (Radio)</option>
                        <option value="Checkbox">Çoklu Seçenek (Checkbox)</option>
                    </select>

                    <div class="answer-options" data-index="${questionIndex}" style="display:none;">
                        <h4>Seçenekler</h4>
                        <div class="options-container"></div>
                        <button type="button" class="btn btn-sm btn-secondary add-option">Seçenek Ekle</button>
                    </div>
                    <button type="button" class="btn btn-sm btn-danger remove-question">Soru Sil</button>
                </div>`;

            $("#questions-container").append(html);
            questionIndex++;
        });

        $(document).on("change", ".question-type", function () {
            var parent = $(this).closest(".question-item");
            var answerOptionsDiv = parent.find(".answer-options");

            if ($(this).val() == "Radio" || $(this).val() == "Checkbox") {
                answerOptionsDiv.show();
            } else {
                answerOptionsDiv.hide();
            }
        });

        $(document).on("click", ".add-option", function () {
            var container = $(this).siblings(".options-container");
            var index = $(this).closest(".answer-options").data("index");
            var optionIndex = container.children().length;

            var optionHtml = `
                <div>
                    <input type="text" class="form-control d-inline-block" name="Questions[${index}].AnswerOptions[${optionIndex}].OptionText" required />
                    <button type="button" class="btn btn-sm btn-danger remove-option">Sil</button>
                </div>`;

            container.append(optionHtml);
        });

        $(document).on("click", ".remove-option", function () {
            $(this).parent().remove();
        });

        $(document).on("click", ".remove-question", function () {
            $(this).closest(".question-item").remove();
        });

        $(".duration-button").click(function () {
            var minutesToAdd = parseInt($(this).data("minutes"));
            var currentDuration = parseInt($("#duration-input").val()) || 0;
            $("#duration-input").val(currentDuration + minutesToAdd);
        });
    </script>
}

<style>
    body {
        all: unset;
        background-color: white;
    }

    .form-control {
        width: 50%;
    }

    .btn{
        margin:5px;
    }
</style>